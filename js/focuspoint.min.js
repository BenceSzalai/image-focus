!function(t,o,a){"use strict";function i(o,a){this.element=o,this.options=t.extend({},e,a),this._defaults=e,this._name=n,this.init()}var n="imageFocus",e={},s={id:!1,focusPoint:{x:50,y:50}},c={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}},u={crop:!1};i.prototype={init:function(){this.getAttachmentData(),this.addFocusPoint(),this.addCropButton(),t("."+c.imageFocus.clickarea).on("click",function(t){i.prototype.moveFocusPoint(t,this),i.prototype.highlightCropButton()}),t("."+c.imageFocus.button).on("click",this.sendImageCropDataByAjax)},getAttachmentData:function(){s.id=t(this.element).data("id"),t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:s},dataType:"json"}).done(function(o){s.focusPoint={x:50,y:50},!0===o.success&&(s.focusPoint=o.focusPoint),t("."+c.imageFocus.point).css({display:"block",left:s.focusPoint.x+"%",top:s.focusPoint.y+"%"})})},addFocusPoint:function(){var o,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(c.imageFocus.img),a.wrap('<div class="'+c.imageFocus.self+'"><div class="'+c.imageFocus.wrapper+'"></div></div>'),(o=t("."+c.imageFocus.wrapper)).append('<div class="'+c.imageFocus.point+'"></div>'),o.append('<div class="'+c.imageFocus.clickarea+'"></div>')},moveFocusPoint:function(o,a){var i=t(a).width(),n=t(a).height(),e=(o.pageX-t(a).offset().left)/i*100,u=(o.pageY-t(a).offset().top)/n*100;s.focusPoint.x=e,s.focusPoint.y=u,t("."+c.imageFocus.point).css({left:e+"%",top:u+"%"})},addCropButton:function(){var o='<button type="button" class="'+c.button.self+" "+c.button.disabled+" crop-attachment "+c.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(this.element).find(".attachment-actions").append(o)},highlightCropButton:function(){var o=t("."+c.imageFocus.button);o.removeClass(c.button.disabled),o.text(focusPointL10n.cropButton),o.addClass(c.button.primary)},activateCropButton:function(){var o=t("."+c.imageFocus.button);o.removeClass(c.button.disabled),o.removeClass(c.button.primary)},disableCropButton:function(){var o=t("."+c.imageFocus.button);o.removeClass(c.button.primary),o.addClass(c.button.disabled)},sendImageCropDataByAjax:function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:s},dataType:"json",beforeSend:function(){if(!0===u.crop)return!1;t("."+c.imageFocus.button).text("Cropping..."),i.prototype.disableCropButton(),u.crop=!0}}).done(function(o){var a=t("."+c.imageFocus.button);!1===o.success?(i.prototype.activateCropButton(),a.text("Please try again")):a.text("Done!"),u.crop=!1})}},t.fn[n]=function(o){return this.each(function(){t.data(this,"plugin_"+n)||t.data(this,"plugin_"+n,new i(this,o))})}}(jQuery,window,document),function(t,o,a){t(a).on("ready",function(){setInterval(function(){var o=t(".attachment-details");if(o.find(".details-image").length&&!t(".image-focus").length)try{o.imageFocus()}catch(t){console.log(t)}},500)})}(jQuery,window,document);