!function(t,e,a){"use strict";var n={_imageFocus:"image-focus",imageFocus:{_wrapper:"image-focus__wrapper",_img:"image-focus__img",_point:"image-focus__point",_clickarea:"image-focus__clickarea",_button:"image-focus__button"},_button:"button",button:{_primary:"button-primary",_disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,o){var c=this;c.$el=t(a),c.el=a,c.$el.data("imageFocus.focusPoint",c);var i,s;c.init=function(){c.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,o),c.addInterfaceElements(),c.attachment.init(),c.focusInterface.init(),c.cropButton.init(),t(e).on("resize",c.attachment.updateDimensionData)},c.addInterfaceElements=function(){var e,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(n.imageFocus._img),a.wrap('<div class="'+n._imageFocus+'"><div class="'+n.imageFocus._wrapper+'"></div></div>'),(e=t("."+n.imageFocus._wrapper)).append('<div class="'+n.imageFocus._point+'"></div>'),e.append('<div class="'+n.imageFocus._clickarea+'"></div>'),i=t("."+n._imageFocus),s=t("."+n.imageFocus._clickarea)},c.attachment={$el:!1,_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50},init:function(){c.attachment.$el=t("."+n.imageFocus._img),c.attachment.getData(),c.attachment.$el.load(function(){c.attachment.updateDimensionData()})},getData:function(){c.attachment._id=t(c.el).data("id");var e={id:c.attachment._id};t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:e},dataType:"json"}).done(function(t){!0===t.success&&(c.attachment._focusPoint=t.focusPoint),c.attachment.updateDimensionData(),c.focusInterface.updateStylePosition(),c.focusInterface.$el.css({display:"block"}),c.focusInterface.updateDimensionData(),c.focusInterface.updateStyleBackground()})},updateDimensionData:function(){var t=c.attachment.$el;c.attachment._width=t.width(),c.attachment._height=t.height(),c.attachment._offset.x=t.offset().left,c.attachment._offset.y=t.offset().top}},c.focusInterface={$el:!1,_width:0,_height:0,_radius:0,_offset:{x:0,y:0},_position:{x:0,y:0},_clickPosition:{x:0,y:0},_state:{move:!1,active:!1,hover:!1},init:function(){c.focusInterface.$el=t("."+n.imageFocus._point),s.on("mousedown",function(t){c.focusInterface.startMove(t,!0).move(t)}),c.focusInterface.$el.on("mousedown",function(t){c.focusInterface.startMove(t)}).on("mouseenter",function(){c.focusInterface.state.hover(!0)}).on("mouseleave",function(){c.focusInterface.state.hover(!1)}),t(e).on("mouseup",function(){c.focusInterface._state.move=!1,c.focusInterface._state.active=!1,i.removeClass("is-active")}).on("mousemove",function(t){c.focusInterface.move(t)}).on("resize",function(){c.focusInterface.updateDimensionData().updateStyle()})},startMove:function(t,e){return c.attachment.updateDimensionData(),c.focusInterface.updateDimensionData().updateClickPosition(t,e),c.cropButton.highlight(),i.addClass("is-active"),c.focusInterface._state.move=!0,c.focusInterface._state.active=!0,this},move:function(t){if(!1===c.focusInterface._state.move)return!1;var e={x:t.pageX,y:t.pageY},a={},n=c.attachment._offset,o=c.focusInterface._clickPosition;a.x=e.x-n.x-o.x,a.y=e.y-n.y-o.y,a.x=u.calc.maxRange(a.x,0,c.attachment._width),a.y=u.calc.maxRange(a.y,0,c.attachment._height);var i={};return i.x=a.x/c.attachment._width*100,i.y=a.y/c.attachment._height*100,c.attachment._focusPoint=i,c.focusInterface._position=a,c.focusInterface.updateStyle(),this},updateStyle:function(){return c.focusInterface.updateStylePosition(),c.focusInterface.updateStyleBackground(),this},updateStylePosition:function(){return c.focusInterface.$el.css({left:c.attachment._focusPoint.x+"%",top:c.attachment._focusPoint.y+"%"}),this},updateStyleBackground:function(){var t=0-(c.focusInterface._position.x-c.focusInterface._radius),e=0-(c.focusInterface._position.y-c.focusInterface._radius);return c.focusInterface.$el.css({backgroundImage:'url("'+c.attachment.$el.attr("src")+'")',backgroundSize:c.attachment._width+"px "+c.attachment._height+"px ",backgroundPosition:t+"px "+e+"px "}),this},updateClickPosition:function(t,e){var a={x:0,y:0};if(!0!==e){var n={x:t.pageX,y:t.pageY},o=c.focusInterface._offset;(a={}).x=n.x-o.x,a.y=n.y-o.y}return c.focusInterface._clickPosition=a,this},updateDimensionData:function(){c.focusInterface._width=c.focusInterface.$el.width(),c.focusInterface._height=c.focusInterface.$el.height();var t=c.focusInterface._width/2;c.focusInterface._radius=t;var e=c.focusInterface.$el.offset();return c.focusInterface._offset={x:e.left+t,y:e.top+t},c.focusInterface._position={x:c.attachment._focusPoint.x/100*c.attachment._width,y:c.attachment._focusPoint.y/100*c.attachment._height},this},state:{hover:function(t){c.focusInterface._state.hover=t,i.toggleClass("is-hover",t)}}},c.cropButton={$el:!1,_ajaxState:!1,init:function(){var e='<button type="button" class="'+n._button+" "+n.button._disabled+" crop-attachment "+n.imageFocus._button+'">'+focusPointL10n.cropButton+"</button>";t(c.el).find(".attachment-actions").append(e),c.cropButton.$el=t("."+n.imageFocus._button),c.cropButton.$el.on("click",c.sendImageCropDataByAjax)},highlight:function(){c.cropButton.$el.removeClass(n.button._disabled).addClass(n.button._primary).text(focusPointL10n.cropButton)},activate:function(){c.cropButton.$el.removeClass(n.button._disabled).removeClass(n.button._primary)},disable:function(){c.cropButton.$el.removeClass(n.button._primary).addClass(n.button._disabled)}},c.sendImageCropDataByAjax=function(){var e={id:c.attachment._id,focusPoint:c.attachment._focusPoint};t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:e},dataType:"json",beforeSend:function(){if(!0===c.cropButton._ajaxState)return!1;c.cropButton.$el.text("Cropping..."),c.cropButton.disable(),c.cropButton._ajaxState=!0}}).always(function(t){var e="Done";!0!==t.success&&(c.cropButton.activate(),e="Please try again"),c.cropButton.$el.text(e),c.cropButton._ajaxState=!1})};var u={};u.calc={maxRange:function(t,e,a){var n=t;return t<e?n=e:t>a&&(n=a),n}}},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(e){return this.each(function(){new t.imageFocus.focusPoint(this,e).init()})}}(jQuery,window,document),function(t,e,a){t(a).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);