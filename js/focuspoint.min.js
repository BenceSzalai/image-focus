!function(t,e,a){"use strict";var o={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,n){var c=this;c.$el=t(a),c.el=a,c.$el.data("imageFocus.focusPoint",c),c.init=function(){c.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,n),c.attachment.getData(),c.addInterfaceElements(),c.attachment.getDimensionData(),c.focusInterface.init(),c.focusInterface.update(),c.cropButton.init(),t(e).on("resize",c.attachment.getDimensionData)},c.addInterfaceElements=function(){var e,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(o.imageFocus.img),a.wrap('<div class="'+o.imageFocus.self+'"><div class="'+o.imageFocus.wrapper+'"></div></div>'),(e=t("."+o.imageFocus.wrapper)).append('<div class="'+o.imageFocus.point+'"></div>'),e.append('<div class="'+o.imageFocus.clickarea+'"></div>')},c.attachment={getData:function(){c._attachment.id=t(c.el).data("id"),t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:this._attachment},dataType:"json"}).done(function(e){!0===e.success&&(c._attachment.focusPoint=e.focusPoint),t("."+o.imageFocus.point).css({display:"block",left:c._attachment.focusPoint.x+"%",top:c._attachment.focusPoint.y+"%"})})},getDimensionData:function(){var e=t("."+o.imageFocus.img);c._attachment.width=e.width(),c._attachment.height=e.height(),c._attachment.position.x=e.offset().left,c._attachment.position.y=e.offset().top}},c.focusInterface={$el:!1,init:function(){c.focusInterface.$el=t("."+o.imageFocus.point),c.focusInterface.$el.on("mousedown",function(e){var a=t(this);c.attachment.getDimensionData(),c.focusInterface.getDimensionData(),c._focusInterface.clickPosition.x=e.pageX-a.offset().left-c._focusInterface.width/2,c._focusInterface.clickPosition.y=e.pageY-a.offset().top-c._focusInterface.height/2,c.cropButton.highlight(),c._focusInterface.state.move=!0}),t(e).on("mouseup",function(){c._focusInterface.state.move=!1}),t(e).on("mousemove",function(t){c.focusInterface.move(t)})},move:function(t){if(!1===c._focusInterface.state.move)return!1;var e={};e.x=t.pageX-c._attachment.position.x-c._focusInterface.clickPosition.x,e.y=t.pageY-c._attachment.position.y-c._focusInterface.clickPosition.y,e.x<0?e.x=0:e.x>c._attachment.width&&(e.x=c._attachment.width),e.y<0?e.y=0:e.y>c._attachment.height&&(e.y=c._attachment.height);var a={};a.x=e.x/c._attachment.width*100,a.y=e.y/c._attachment.height*100,c._attachment.focusPoint=a,c._focusInterface.offset=e,c.focusInterface.update()},update:function(){var e=t("."+o.imageFocus.img),a=0-(c._focusInterface.offset.x-c._focusInterface.width/2),n=0-(c._focusInterface.offset.y-c._focusInterface.height/2);c.focusInterface.$el.css({left:c._attachment.focusPoint.x+"%",top:c._attachment.focusPoint.y+"%",backgroundImage:'url("'+e.attr("src")+'")',backgroundSize:c._attachment.width+"px "+c._attachment.height+"px ",backgroundPosition:a+"px "+n+"px "})},getDimensionData:function(){c._focusInterface.width=c.focusInterface.$el.width(),c._focusInterface.height=c.focusInterface.$el.height()}},c.cropButton={$el:!1,init:function(){var e='<button type="button" class="'+o.button.self+" "+o.button.disabled+" crop-attachment "+o.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(c.el).find(".attachment-actions").append(e),c.cropButton.$el=t("."+o.imageFocus.button),c.cropButton.$el.on("click",c.sendImageCropDataByAjax)},highlight:function(){c.cropButton.$el.removeClass(o.button.disabled),c.cropButton.$el.text(focusPointL10n.cropButton),c.cropButton.$el.addClass(o.button.primary)},activate:function(){c.cropButton.$el.removeClass(o.button.disabled),c.cropButton.$el.removeClass(o.button.primary)},disable:function(){c.cropButton.$el.removeClass(o.button.primary),c.cropButton.$el.addClass(o.button.disabled)}},c.sendImageCropDataByAjax=function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:c._attachment},dataType:"json",beforeSend:function(){if(!0===c._ajaxState.crop)return!1;t("."+o.imageFocus.button).text("Cropping..."),c.cropButton.disable(),c._ajaxState.crop=!0}}).done(function(e){var a=t("."+o.imageFocus.button);!1===e.success?(c.cropButton.activate(),a.text("Please try again")):a.text("Done!"),c._ajaxState.crop=!1})},c._attachment={id:!1,width:!1,height:!1,position:{x:!1,y:!1},focusPoint:{x:50,y:50}},c._focusInterface={width:0,height:0,offset:{x:0,y:0},clickPosition:{x:0,y:0},state:{move:!1}},c._ajaxState={crop:!1},c.init()},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(e){return this.each(function(){new t.imageFocus.focusPoint(this,e)})}}(jQuery,window,document),function(t,e,a){t(a).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);