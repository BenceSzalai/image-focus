!function(o,s){"use strict";var u="image-focus",f={_wrapper:"image-focus__wrapper",_img:"image-focus__img",_point:"image-focus__point",_clickarea:"image-focus__clickarea",_button:"image-focus__button"},r="button",l={_primary:"button-primary",_disabled:"button-disabled"};o.imageFocus||(o.imageFocus={}),o.imageFocus.focusPoint=function(t,e){var a,n,c=this;c.$el=o(t),c.el=t,c.$el.data("imageFocus.focusPoint",c),c.init=function(){c.options=o.extend({},o.imageFocus.focusPoint.defaultOptions,e),c.addInterfaceElements(),c.attachment.init(),c.focusInterface.init(),c.cropButton.init(),o(s).on("resize",c.attachment.updateDimensionData)},c.addInterfaceElements=function(){var t=o(".edit-attachment-frame .attachment-media-view .details-image");t.addClass(f._img),t.wrap('<div class="'+u+'"><div class="'+f._wrapper+'"></div></div>'),(t=o("."+f._wrapper)).append('<div class="'+f._point+'"></div>'),t.append('<div class="'+f._clickarea+'"></div>'),a=o("."+u),n=o("."+f._clickarea)},c.attachment={$el:!1,_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50},init:function(){c.attachment.$el=o("."+f._img),c.attachment.getData(),c.attachment.$el.load(function(){c.attachment.updateDimensionData()})},getData:function(){c.attachment._id=i.getUrlParameter("item");var t={id:c.attachment._id};o.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:t},dataType:"json"}).always(function(t){if(!0===t.success)try{if(!t.focusPoint.hasOwnProperty("x")||!t.focusPoint.hasOwnProperty("y"))throw"Wrong object properties";c.attachment._focusPoint=t.focusPoint}catch(t){console.log(t)}c.attachment.updateDimensionData(),c.focusInterface.updateStylePosition(),c.focusInterface.$el.css({display:"block"}),c.focusInterface.updateDimensionData(),c.focusInterface.updateStyleBackground()})},updateDimensionData:function(){var t=c.attachment.$el;c.attachment._width=t.width(),c.attachment._height=t.height(),c.attachment._offset.x=t.offset().left,c.attachment._offset.y=t.offset().top}},c.focusInterface={$el:!1,_width:0,_height:0,_radius:0,_offset:{x:0,y:0},_position:{x:0,y:0},_clickPosition:{x:0,y:0},_state:{move:!1,active:!1,hover:!1},init:function(){c.focusInterface.$el=o("."+f._point),n.on("mousedown",function(t){1===t.which&&c.focusInterface.startMove(t,!0).move(t)}),c.focusInterface.$el.on("mousedown",function(t){1===t.which&&c.focusInterface.startMove(t)}).on("mouseenter",function(){c.focusInterface.state.hover(!0)}).on("mouseleave",function(){c.focusInterface.state.hover(!1)}),o(s).on("mouseup",function(t){1===t.which&&(c.focusInterface._state.move=!1,c.focusInterface._state.active=!1,a.removeClass("is-active"))}).on("mousemove",function(t){c.focusInterface.move(t)}).on("resize",function(){c.focusInterface.updateDimensionData().updateStyle()})},startMove:function(t,e){return c.attachment.updateDimensionData(),c.focusInterface.updateDimensionData().updateClickPosition(t,e),c.cropButton.highlight(),a.addClass("is-active"),c.focusInterface._state.move=!0,c.focusInterface._state.active=!0,this},move:function(t){if(!1===c.focusInterface._state.move)return!1;var e=t.pageX,a=t.pageY,n={},o=c.attachment._offset,t=c.focusInterface._clickPosition;n.x=e-o.x-t.x,n.y=a-o.y-t.y,n.x=i.calc.maxRange(n.x,0,c.attachment._width),n.y=i.calc.maxRange(n.y,0,c.attachment._height);t={};return t.x=n.x/c.attachment._width*100,t.y=n.y/c.attachment._height*100,c.attachment._focusPoint=t,c.focusInterface._position=n,c.focusInterface.updateStyle(),this},updateStyle:function(){return c.focusInterface.updateStylePosition(),c.focusInterface.updateStyleBackground(),this},updateStylePosition:function(){return c.focusInterface.$el.css({left:c.attachment._focusPoint.x+"%",top:c.attachment._focusPoint.y+"%"}),this},updateStyleBackground:function(){var t=0-(c.focusInterface._position.x-c.focusInterface._radius),e=0-(c.focusInterface._position.y-c.focusInterface._radius);return c.focusInterface.$el.css({backgroundImage:'url("'+c.attachment.$el.attr("src")+'")',backgroundSize:c.attachment._width+"px "+c.attachment._height+"px ",backgroundPosition:t+"px "+e+"px "}),this},updateClickPosition:function(t,e){var a,n={x:0,y:0};return!0!==e&&(a=t.pageX,e=t.pageY,t=c.focusInterface._offset,(n={}).x=a-t.x,n.y=e-t.y),c.focusInterface._clickPosition=n,this},updateDimensionData:function(){c.focusInterface._width=c.focusInterface.$el.width(),c.focusInterface._height=c.focusInterface.$el.height();var t=c.focusInterface._width/2;c.focusInterface._radius=t;var e=c.focusInterface.$el.offset();return c.focusInterface._offset={x:e.left+t,y:e.top+t},c.focusInterface._position={x:c.attachment._focusPoint.x/100*c.attachment._width,y:c.attachment._focusPoint.y/100*c.attachment._height},this},state:{hover:function(t){c.focusInterface._state.hover=t,a.toggleClass("is-hover",t)}}},c.cropButton={$el:!1,_ajaxState:!1,init:function(){var t='<button type="button" class="'+r+" "+l._disabled+" crop-attachment "+f._button+'">'+focusPointL10n.cropButton+"</button>";o(c.el).find(".attachment-actions").append(t),c.cropButton.$el=o("."+f._button),c.cropButton.$el.on("click",c.sendImageCropDataByAjax)},highlight:function(){c.cropButton.$el.removeClass(l._disabled).addClass(l._primary).text(focusPointL10n.cropButton)},activate:function(){c.cropButton.$el.removeClass(l._disabled).removeClass(l._primary)},disable:function(){c.cropButton.$el.removeClass(l._primary).addClass(l._disabled)}},c.sendImageCropDataByAjax=function(){var t={id:c.attachment._id,focusPoint:c.attachment._focusPoint};o.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:t},dataType:"json",beforeSend:function(){if(!0===c.cropButton._ajaxState)return!1;c.cropButton.$el.text("Cropping..."),c.cropButton.disable(),c.cropButton._ajaxState=!0}}).always(function(t){var e="Done";!0!==t.success&&(c.cropButton.activate(),e="Please try again"),c.cropButton.$el.text(e),c.cropButton._ajaxState=!1})};var i={calc:{maxRange:function(t,e,a){var n=t;return t<e?n=e:a<t&&(n=a),n}},getUrlParameter:function(t){var n={};s.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,a){n[e]=a});return n[t]||null}}},o.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},o.fn.imageFocus_focusPoint=function(t){return this.each(function(){new o.imageFocus.focusPoint(this,t).init()})}}(jQuery,window,document),function(e,t){e(t).on("ready",function(){e("body").on("click","li.attachment",function(){var t=e(".attachment-details");if(t.find(".details-image").length&&!e(".image-focus").length)try{t.imageFocus_focusPoint()}catch(t){console.log(t)}})})}(jQuery,(window,document));