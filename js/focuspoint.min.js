!function(t,e,a){"use strict";var o={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,n){var c=this;c.$el=t(a),c.el=a,c.$el.data("imageFocus.focusPoint",c),c.init=function(){c.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,n),c.addInterfaceElements(),c.attachment.init(),c.focusInterface.init(),c.cropButton.init(),t(e).on("resize",c.attachment.updateDimensionData)},c.addInterfaceElements=function(){var e,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(o.imageFocus.img),a.wrap('<div class="'+o.imageFocus.self+'"><div class="'+o.imageFocus.wrapper+'"></div></div>'),(e=t("."+o.imageFocus.wrapper)).append('<div class="'+o.imageFocus.point+'"></div>'),e.append('<div class="'+o.imageFocus.clickarea+'"></div>')},c.attachment={$el:!1,_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50},init:function(){c.attachment.$el=t("."+o.imageFocus.img),c.attachment.getData(),c.attachment.$el.load(function(){c.attachment.updateDimensionData()})},getData:function(){c.attachment._id=t(c.el).data("id");var e={id:c.attachment._id};t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:e},dataType:"json"}).done(function(t){!0===t.success&&(c.attachment._focusPoint=t.focusPoint),c.attachment.updateDimensionData(),c.focusInterface.updateStylePosition(),c.focusInterface.$el.css({display:"block"}),c.focusInterface.updateDimensionData(),c.focusInterface.updateStyleBackground()})},updateDimensionData:function(){var t=c.attachment.$el;c.attachment._width=t.width(),c.attachment._height=t.height(),c.attachment._offset.x=t.offset().left,c.attachment._offset.y=t.offset().top}},c.focusInterface={$el:!1,_width:0,_height:0,_radius:0,_offset:{x:0,y:0},_position:{x:0,y:0},_clickPosition:{x:0,y:0},_state:{move:!1},init:function(){c.focusInterface.$el=t("."+o.imageFocus.point),c.focusInterface.$el.on("mousedown",function(t){c.attachment.updateDimensionData(),c.focusInterface.updateDimensionData(),c.focusInterface.updateClickPosition(t),c.cropButton.highlight(),c.focusInterface._state.move=!0}),t(e).on("mouseup",function(){c.focusInterface._state.move=!1}),t(e).on("mousemove",function(t){c.focusInterface.move(t)}),t(e).on("resize",function(){c.focusInterface.updateDimensionData(),c.focusInterface.updateStyle()})},move:function(t){if(!1===c.focusInterface._state.move)return!1;var e={};e.x=t.pageX-c.attachment._offset.x-c.focusInterface._clickPosition.x,e.y=t.pageY-c.attachment._offset.y-c.focusInterface._clickPosition.y,e.x<0?e.x=0:e.x>c.attachment._width&&(e.x=c.attachment._width),e.y<0?e.y=0:e.y>c.attachment._height&&(e.y=c.attachment._height);var a={};a.x=e.x/c.attachment._width*100,a.y=e.y/c.attachment._height*100,c.attachment._focusPoint=a,c.focusInterface._position=e,c.focusInterface.updateStyle()},updateStyle:function(){c.focusInterface.updateStylePosition(),c.focusInterface.updateStyleBackground()},updateStylePosition:function(){c.focusInterface.$el.css({left:c.attachment._focusPoint.x+"%",top:c.attachment._focusPoint.y+"%"})},updateStyleBackground:function(){var t=0-(c.focusInterface._position.x-c.focusInterface._radius),e=0-(c.focusInterface._position.y-c.focusInterface._radius);c.focusInterface.$el.css({backgroundImage:'url("'+c.attachment.$el.attr("src")+'")',backgroundSize:c.attachment._width+"px "+c.attachment._height+"px ",backgroundPosition:t+"px "+e+"px "})},updateClickPosition:function(t){c.focusInterface._clickPosition.x=t.pageX-c.focusInterface._offset.x,c.focusInterface._clickPosition.y=t.pageY-c.focusInterface._offset.y},updateDimensionData:function(){c.focusInterface._width=c.focusInterface.$el.width(),c.focusInterface._height=c.focusInterface.$el.height(),c.focusInterface._radius=c.focusInterface._width/2,c.focusInterface._offset.x=c.focusInterface.$el.offset().left+c.focusInterface._radius,c.focusInterface._offset.y=c.focusInterface.$el.offset().top+c.focusInterface._radius,c.focusInterface._position.x=c.attachment._focusPoint.x/100*c.attachment._width,c.focusInterface._position.y=c.attachment._focusPoint.y/100*c.attachment._height}},c.cropButton={$el:!1,init:function(){var e='<button type="button" class="'+o.button.self+" "+o.button.disabled+" crop-attachment "+o.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(c.el).find(".attachment-actions").append(e),c.cropButton.$el=t("."+o.imageFocus.button),c.cropButton.$el.on("click",c.sendImageCropDataByAjax)},highlight:function(){c.cropButton.$el.removeClass(o.button.disabled),c.cropButton.$el.text(focusPointL10n.cropButton),c.cropButton.$el.addClass(o.button.primary)},activate:function(){c.cropButton.$el.removeClass(o.button.disabled),c.cropButton.$el.removeClass(o.button.primary)},disable:function(){c.cropButton.$el.removeClass(o.button.primary),c.cropButton.$el.addClass(o.button.disabled)}},c.sendImageCropDataByAjax=function(){var e={id:c.attachment._id,focusPoint:c.attachment._focusPoint};t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:e},dataType:"json",beforeSend:function(){if(!0===c._ajaxState.crop)return!1;c.cropButton.$el.text("Cropping..."),c.cropButton.disable(),c._ajaxState.crop=!0}}).done(function(t){!0===t.success?c.cropButton.$el.text("Done!"):!1===t.success&&(c.cropButton.activate(),c.cropButton.$el.text("Please try again")),c._ajaxState.crop=!1})},c._ajaxState={crop:!1}},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(e){return this.each(function(){new t.imageFocus.focusPoint(this,e).init()})}}(jQuery,window,document),function(t,e,a){t(a).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);