!function(t,e,a){"use strict";var o={_imageFocus:"image-focus",imageFocus:{_wrapper:"image-focus__wrapper",_img:"image-focus__img",_point:"image-focus__point",_clickarea:"image-focus__clickarea",_button:"image-focus__button"},_button:"button",button:{_primary:"button-primary",_disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,n){var c=this;c.$el=t(a),c.el=a,c.$el.data("imageFocus.focusPoint",c),c.init=function(){c.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,n),c.addInterfaceElements(),c.attachment.init(),c.focusInterface.init(),c.cropButton.init(),t(e).on("resize",c.attachment.updateDimensionData)},c.addInterfaceElements=function(){var e,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(o.imageFocus._img),a.wrap('<div class="'+o._imageFocus+'"><div class="'+o.imageFocus._wrapper+'"></div></div>'),(e=t("."+o.imageFocus._wrapper)).append('<div class="'+o.imageFocus._point+'"></div>'),e.append('<div class="'+o.imageFocus._clickarea+'"></div>')},c.attachment={$el:!1,_id:!1,_width:!1,_height:!1,_offset:{x:!1,y:!1},_focusPoint:{x:50,y:50},init:function(){c.attachment.$el=t("."+o.imageFocus._img),c.attachment.getData(),c.attachment.$el.load(function(){c.attachment.updateDimensionData()})},getData:function(){c.attachment._id=t(c.el).data("id");var e={id:c.attachment._id};t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:e},dataType:"json"}).done(function(t){!0===t.success&&(c.attachment._focusPoint=t.focusPoint),c.attachment.updateDimensionData(),c.focusInterface.updateStylePosition(),c.focusInterface.$el.css({display:"block"}),c.focusInterface.updateDimensionData(),c.focusInterface.updateStyleBackground()})},updateDimensionData:function(){var t=c.attachment.$el;c.attachment._width=t.width(),c.attachment._height=t.height(),c.attachment._offset.x=t.offset().left,c.attachment._offset.y=t.offset().top}},c.focusInterface={$el:!1,_width:0,_height:0,_radius:0,_offset:{x:0,y:0},_position:{x:0,y:0},_clickPosition:{x:0,y:0},_state:{move:!1,active:!1,hover:!1},init:function(){c.focusInterface.$el=t("."+o.imageFocus._point);var a=t("."+o._imageFocus);t("."+o.imageFocus._clickarea).on("mousedown",function(t){c.focusInterface.startMove(t,!0),c.focusInterface.move(t)}),c.focusInterface.$el.on("mousedown",function(t){c.focusInterface.startMove(t)}),c.focusInterface.$el.on("mouseenter",function(){c.focusInterface._state.hover=!0,a.addClass("is-hover")}),c.focusInterface.$el.on("mouseleave",function(){c.focusInterface._state.hover=!1,a.removeClass("is-hover")}),t(e).on("mouseup",function(){c.focusInterface._state.move=!1,c.focusInterface._state.active=!1,a.removeClass("is-active")}),t(e).on("mousemove",function(t){c.focusInterface.move(t)}),t(e).on("resize",function(){c.focusInterface.updateDimensionData(),c.focusInterface.updateStyle()})},startMove:function(e,a){var n=t("."+o._imageFocus);c.attachment.updateDimensionData(),c.focusInterface.updateDimensionData().updateClickPosition(e,a),c.cropButton.highlight(),n.addClass("is-active"),c.focusInterface._state.move=!0,c.focusInterface._state.active=!0},move:function(t){if(!1===c.focusInterface._state.move)return!1;var e={};e.x=t.pageX-c.attachment._offset.x-c.focusInterface._clickPosition.x,e.y=t.pageY-c.attachment._offset.y-c.focusInterface._clickPosition.y,e.x<0?e.x=0:e.x>c.attachment._width&&(e.x=c.attachment._width),e.y<0?e.y=0:e.y>c.attachment._height&&(e.y=c.attachment._height);var a={};a.x=e.x/c.attachment._width*100,a.y=e.y/c.attachment._height*100,c.attachment._focusPoint=a,c.focusInterface._position=e,c.focusInterface.updateStyle()},updateStyle:function(){c.focusInterface.updateStylePosition(),c.focusInterface.updateStyleBackground()},updateStylePosition:function(){c.focusInterface.$el.css({left:c.attachment._focusPoint.x+"%",top:c.attachment._focusPoint.y+"%"})},updateStyleBackground:function(){var t=0-(c.focusInterface._position.x-c.focusInterface._radius),e=0-(c.focusInterface._position.y-c.focusInterface._radius);c.focusInterface.$el.css({backgroundImage:'url("'+c.attachment.$el.attr("src")+'")',backgroundSize:c.attachment._width+"px "+c.attachment._height+"px ",backgroundPosition:t+"px "+e+"px "})},updateClickPosition:function(t,e){var a=0,o=0;return!0!==e&&(a=t.pageX-c.focusInterface._offset.x,o=t.pageY-c.focusInterface._offset.y),c.focusInterface._clickPosition.x=a,c.focusInterface._clickPosition.y=o,this},updateDimensionData:function(){return c.focusInterface._width=c.focusInterface.$el.width(),c.focusInterface._height=c.focusInterface.$el.height(),c.focusInterface._radius=c.focusInterface._width/2,c.focusInterface._offset.x=c.focusInterface.$el.offset().left+c.focusInterface._radius,c.focusInterface._offset.y=c.focusInterface.$el.offset().top+c.focusInterface._radius,c.focusInterface._position.x=c.attachment._focusPoint.x/100*c.attachment._width,c.focusInterface._position.y=c.attachment._focusPoint.y/100*c.attachment._height,this}},c.cropButton={$el:!1,_ajaxState:!1,init:function(){var e='<button type="button" class="'+o._button+" "+o.button._disabled+" crop-attachment "+o.imageFocus._button+'">'+focusPointL10n.cropButton+"</button>";t(c.el).find(".attachment-actions").append(e),c.cropButton.$el=t("."+o.imageFocus._button),c.cropButton.$el.on("click",c.sendImageCropDataByAjax)},highlight:function(){c.cropButton.$el.removeClass(o.button._disabled),c.cropButton.$el.text(focusPointL10n.cropButton),c.cropButton.$el.addClass(o.button._primary)},activate:function(){c.cropButton.$el.removeClass(o.button._disabled),c.cropButton.$el.removeClass(o.button._primary)},disable:function(){c.cropButton.$el.removeClass(o.button._primary),c.cropButton.$el.addClass(o.button._disabled)}},c.sendImageCropDataByAjax=function(){var e={id:c.attachment._id,focusPoint:c.attachment._focusPoint};t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:e},dataType:"json",beforeSend:function(){if(!0===c.cropButton._ajaxState)return!1;c.cropButton.$el.text("Cropping..."),c.cropButton.disable(),c.cropButton._ajaxState=!0}}).always(function(t){var e="Done";!0!==t.success&&(c.cropButton.activate(),e="Please try again"),c.cropButton.$el.text(e),c.cropButton._ajaxState=!1})}},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(e){return this.each(function(){new t.imageFocus.focusPoint(this,e).init()})}}(jQuery,window,document),function(t,e,a){t(a).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);