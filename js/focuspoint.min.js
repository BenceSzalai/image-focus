!function(t,o,a){"use strict";var e={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea",button:"image-focus__button"},button:{self:"button",primary:"button-primary",disabled:"button-disabled"}};t.imageFocus||(t.imageFocus={}),t.imageFocus.focusPoint=function(a,n){var i=this;i.$el=t(a),i.el=a,i.$el.data("imageFocus.focusPoint",i),i.init=function(){i.options=t.extend({},t.imageFocus.focusPoint.defaultOptions,n),i.getAttachmentData(),i.addImageElements(),i.getAttachmentDimensionData(),i.cropButton.init(),i.moveFocusPointActions(),t("."+e.imageFocus.button).on("click",i.sendImageCropDataByAjax),t(o).on("resize",i.getAttachmentDimensionData)},i.getAttachmentData=function(){i._attachment.id=t(i.el).data("id"),t.ajax({type:"POST",url:ajaxurl,data:{action:"get-focuspoint",attachment:this._attachment},dataType:"json"}).done(function(o){!0===o.success&&(i._attachment.focusPoint=o.focusPoint),t("."+e.imageFocus.point).css({display:"block",left:i._attachment.focusPoint.x+"%",top:i._attachment.focusPoint.y+"%"})})},i.getAttachmentDimensionData=function(){var o=t("."+e.imageFocus.img);i._attachment.width=o.width(),i._attachment.height=o.height(),i._attachment.position.x=o.offset().left,i._attachment.position.y=o.offset().top},i.getFocusInterfaceDimensionData=function(){var o=t("."+e.imageFocus.point);i._focusInterface.width=o.width(),i._focusInterface.height=o.height()},i.addImageElements=function(){var o,a=t(".edit-attachment-frame .attachment-media-view .details-image");a.addClass(e.imageFocus.img),a.wrap('<div class="'+e.imageFocus.self+'"><div class="'+e.imageFocus.wrapper+'"></div></div>'),(o=t("."+e.imageFocus.wrapper)).append('<div class="'+e.imageFocus.point+'"></div>'),o.append('<div class="'+e.imageFocus.clickarea+'"></div>')},i.moveFocusPointActions=function(){t("."+e.imageFocus.point).on("mousedown",function(o){var a=t(this);i.getAttachmentDimensionData(),i.getFocusInterfaceDimensionData(),i._focusInterface.clickPosition.x=o.pageX-a.offset().left-i._focusInterface.width/2,i._focusInterface.clickPosition.y=o.pageY-a.offset().top-i._focusInterface.height/2,i.cropButton.highlight(),i._focusInterface.state.move=!0}),t(o).on("mouseup",function(){i._focusInterface.state.move=!1}),t(o).on("mousemove",function(t){i.moveFocusPoint(t)})},i.moveFocusPoint=function(o){if(!1===i._focusInterface.state.move)return!1;var a=o.pageX-i._attachment.position.x-i._focusInterface.clickPosition.x,n=o.pageY-i._attachment.position.y-i._focusInterface.clickPosition.y;i._attachment.focusPoint.x=a/i._attachment.width*100,i._attachment.focusPoint.y=n/i._attachment.height*100,i._attachment.focusPoint.x<0?i._attachment.focusPoint.x=0:i._attachment.focusPoint.x>100&&(i._attachment.focusPoint.x=100),i._attachment.focusPoint.y<0?i._attachment.focusPoint.y=0:i._attachment.focusPoint.y>100&&(i._attachment.focusPoint.y=100),t("."+e.imageFocus.point).css({left:i._attachment.focusPoint.x+"%",top:i._attachment.focusPoint.y+"%"})},i.cropButton={_el:!1,init:function(){var o='<button type="button" class="'+e.button.self+" "+e.button.disabled+" crop-attachment "+e.imageFocus.button+'">'+focusPointL10n.cropButton+"</button>";t(i.el).find(".attachment-actions").append(o),i.cropButton._el=t("."+e.imageFocus.button)},highlight:function(){i.cropButton._el.removeClass(e.button.disabled),i.cropButton._el.text(focusPointL10n.cropButton),i.cropButton._el.addClass(e.button.primary)},activate:function(){i.cropButton._el.removeClass(e.button.disabled),i.cropButton._el.removeClass(e.button.primary)},disable:function(){i.cropButton._el.removeClass(e.button.primary),i.cropButton._el.addClass(e.button.disabled)}},i.sendImageCropDataByAjax=function(){t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",attachment:i._attachment},dataType:"json",beforeSend:function(){if(!0===i._ajaxState.crop)return!1;t("."+e.imageFocus.button).text("Cropping..."),i.cropButton.disable(),i._ajaxState.crop=!0}}).done(function(o){var a=t("."+e.imageFocus.button);!1===o.success?(i.cropButton.activate(),a.text("Please try again")):a.text("Done!"),i._ajaxState.crop=!1})},i._attachment={id:!1,width:!1,height:!1,position:{x:!1,y:!1},focusPoint:{x:50,y:50}},i._focusInterface={state:{move:!1},clickPosition:{x:0,y:0},width:0,height:0},i._ajaxState={crop:!1},i.init()},t.imageFocus.focusPoint.defaultOptions={myDefaultValue:""},t.fn.imageFocus_focusPoint=function(o){return this.each(function(){new t.imageFocus.focusPoint(this,o)})}}(jQuery,window,document),function(t,o,a){t(a).on("ready",function(){setInterval(function(){var o=t(".attachment-details");if(o.find(".details-image").length&&!t(".image-focus").length)try{o.imageFocus_focusPoint()}catch(t){console.log(t)}},500)})}(jQuery,window,document);