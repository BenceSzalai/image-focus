!function(t,e,i){function a(e,i){this.element=e,this.options=t.extend({},c,i),this._defaults=c,this._name=o,this.init()}var o="imageFocus",c={},n={attachmentId:!1,focus:{x:50,y:50}},s={imageFocus:{self:"image-focus",wrapper:"image-focus__wrapper",img:"image-focus__img",point:"image-focus__point",clickarea:"image-focus__clickarea"}};a.prototype={init:function(){this.setImageData(),this.addFocusPoint(),t("."+s.imageFocus.clickarea).on("click",this.moveFocusPoint)},setImageData:function(){n.attachmentId=t(this.element).data("id")},addFocusPoint:function(){console.log("add focuspoint");var e,i=t(".edit-attachment-frame .attachment-media-view .details-image");i.addClass(s.imageFocus.img),i.wrap('<div class="'+s.imageFocus.self+'"><div class="'+s.imageFocus.wrapper+'"></div></div>'),(e=t("."+s.imageFocus.wrapper)).append('<div class="'+s.imageFocus.point+'"></div>'),e.append('<div class="'+s.imageFocus.clickarea+'"></div>')},moveFocusPoint:function(e){var i=t(this).width(),a=t(this).height(),o=(e.pageX-t(this).offset().left)/i*100,c=(e.pageY-t(this).offset().top)/a*100;n.focus.x=o,n.focus.y=c,console.log("percentageX:"+o.toFixed(2)+", percentageY:"+c.toFixed(2)),t("."+s.imageFocus.point).css({left:o+"%",top:c+"%"}),t.ajax({type:"POST",url:ajaxurl,data:{action:"initialize-crop",percentageX:o,percentageY:c},dataType:"json"})}},t.fn[o]=function(e){return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new a(this,e))})}}(jQuery,window,document),function(t,e,i){t(i).on("ready",function(){setInterval(function(){var e=t(".attachment-details");if(e.find(".details-image").length&&!t(".image-focus").length)try{e.imageFocus()}catch(t){console.log(t)}},500)})}(jQuery,window,document);